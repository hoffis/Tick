<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

        <title>Tag dispatching - Tick</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/prettify-1.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">Tick</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../builder/">Creating a Trait</a>
                            </li>
                        
                            <li >
                                <a href="../requires/">Template constraints</a>
                            </li>
                        
                            <li >
                                <a href="../check/">Checking a Trait</a>
                            </li>
                        
                            <li class="active">
                                <a href="./">Tag dispatching</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../requirements/">Requirements</a>
                            </li>
                        
                            <li >
                                <a href="../acknowledgments/">Acknowledgments</a>
                            </li>
                        
                            <li >
                                <a href="../design/">Design Notes</a>
                            </li>
                        
                            <li >
                                <a href="../zlang/">ZLang</a>
                            </li>
                        
                            <li >
                                <a href="../license/">License</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../check/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../requirements/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/pfultz2/Tick">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#tag-dispatching">Tag dispatching</a></li>
        
            <li><a href="#specialization">Specialization</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="tag-dispatching">Tag dispatching</h1>
<p>Tag dispatching allows for functions to be ordered by the refinements defined in the trait. For example, if we try to implement an <code>advance</code> function like <a href="http://en.cppreference.com/w/cpp/iterator/advance"><code>std::advance</code></a>. First, we can define the traits for the different traversals:</p>
<pre class="prettyprint well"><code class="cpp">TICK_TRAIT(is_incrementable)
{
    template&lt;class T&gt;
    auto requires_(T&amp;&amp; x) -&gt; tick::valid&lt;
        decltype(x++),
        decltype(++x)
    &gt;;
};

TICK_TRAIT(is_decrementable, is_incrementable&lt;_&gt;)
{
    template&lt;class T&gt;
    auto requires_(T&amp;&amp; x) -&gt; tick::valid&lt;
        decltype(x--),
        decltype(--x)
    &gt;;
};

TICK_TRAIT(is_advanceable, is_decrementable&lt;_&gt;)
{
    template&lt;class T, class Number&gt;
    auto requires_(T&amp;&amp; x, Number n) -&gt; tick::valid&lt;
        decltype(x += n)
    &gt;;
};
</code></pre>

<p>Then we can try to use template constraints for the different overloads:</p>
<p>template<class Iterator, TICK_REQUIRES(is_advanceable<Iterator>())&gt;
void advance(Iterator&amp; it, int n)
{
    it += n;
}</p>
<p>template<class Iterator, TICK_REQUIRES(is_decrementable<Iterator>())&gt;
void advance(Iterator&amp; it, int n)
{
    if (n &gt; 0) while (n--) ++it;
    else 
    {
        n *= -1;
        while (n--) --it;
    }
}</p>
<p>template<class Iterator, TICK_REQUIRES(is_incrementable<Iterator>())&gt;
void advance(Iterator&amp; it, int n)
{
    while (n--) ++it;
}</p>
<pre class="prettyprint well"><code>
However, this leads to ambiguities when we try to use it with iterators to vectors. That is because those iterators are valid for all three overloads. So, tag dispatching allows us to pick the overload that is the most refined. First, we need to call `most_refined` which will retrieve the tags for each each trait. So then `advance` could be implemented like this:

```cpp
template&lt;class Iterator&gt;
void advance_impl(Iterator&amp; it, int n, tick::tag&lt;is_advanceable&gt;)
{
    it += n;
}

template&lt;class Iterator&gt;
void advance_impl(Iterator&amp; it, int n, tick::tag&lt;is_decrementable&gt;)
{
    if (n &gt; 0) while (n--) ++it;
    else 
    {
        n *= -1;
        while (n--) --it;
    }
}

template&lt;class Iterator&gt;
void advance_impl(Iterator&amp; it, int n, tick::tag&lt;is_incrementable&gt;)
{
    while (n--) ++it;
}

template&lt;class Iterator&gt;
void advance(Iterator&amp; it, int n)
{
    advance_impl(it, n, tick::most_refined&lt;is_advanceable&lt;Iterator&gt;&gt;());
}
</code></pre>

<h2 id="specialization">Specialization</h2>
<p>Tag dispatching will still work with specialization. Say, for instance, someone implemented an iterator called <code>foo_iterator</code> that when the user called <code>+=</code> it would crash at runtime. So we would like to specialize <code>is_advanceable</code> to make it false, so the <code>+=</code> won't be called:</p>
<pre class="prettyprint well"><code class="cpp">template&lt;&gt;
struct is_advanceable&lt;foo_iterator&gt;
: std::false_type
{};
</code></pre>

<p>So this will exclude the <code>is_advanceable</code> overload, but the <code>is_decrementable</code> and <code>is_incrementable</code> will still be called.</p>
</div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/prettify-1.0.min.js"></script>
        <script src="../js/base.js"></script>
        
    </body>
</html>